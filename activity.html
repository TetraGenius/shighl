<html>
<script src="./vendor/solid-auth-client.bundle.js"></script>
<script src="./vendor/solid-query-ldflex.bundle.js"></script>
<script src="./window/shighl.bundle.js"></script>

<script>

let sh, pod, session,  activity, name, friends, inbox, storage
sh = new Shighl()
session = new sh.session()

async function mycallback(webId){
  console.log("WebId: ",webId)
  if (webId != null){
    logged(webId)
  }else{
    session.login()
  }
}

async function init(){
  pod = new sh.pod()
  activity = new sh.activity()
  console.log(activity)
  await session.track(mycallback)
}

async function logged(webId){
  pod.webId = webId
  name = await pod.name
  console.log("POD", pod)
  friends = await pod.friends
  inbox = await pod.inbox
  storage = await pod.storage
  console.log(pod.webId)
  console.log("Name: ", name)
  console.log("Friends: ", friends)
  console.log("Inbox: ", inbox)
  console.log("Storage: ", storage)
  document.getElementById("root-folder").value = storage+"public/acl_ok/"
  rootFolderInput()
}

async function createFolders(){
  let rf = document.getElementById("root-folder").value.trim()
  rf = rf.endsWith("/") ? rf : rf+"/";
  console.log(rf)
  activity.testacl(pod.webId, rf)
  document.getElementById("link-folder").href = rf
  document.getElementById("link-folder").innerHTML = rf
}

function sendNote(){
  /*  let example_activity = {
  "@context": "https://www.w3.org/ns/activitystreams",
  "summary": "Sally created a note",
  "type": "Create",
  "actor": {
  "type": "Person",
  "name": "Sally"
},
"object": {
"type": "Note",
"name": "A Simple Note",
"content": "This is a simple note"
}
}*/

let test_activity = {
  "@context": "https://www.w3.org/ns/activitystreams",
  "summary": name+" created a note",
  "type": "Create",
  "actor": {
    "type": "Person",
    "name": name,
    "id": pod.webId
  },
  "object": {
    "type": "Note",
    "name": document.getElementById("note-title").value.trim(),
    "content": document.getElementById("note-content").value.trim()
  }
}

activity.create = test_activity
document.getElementById("note-title").value=""
document.getElementById("note-content").value=""
//activity.create = example_activity

}

function rootFolderInput(){
  let rf = document.getElementById("root-folder").value.trim()
  rf = rf.endsWith("/") ? rf : rf+"/";
  console.log(rf)
  document.getElementById("inbox-folder").innerHTML = rf+"inbox/"
  document.getElementById("outbox-folder").innerHTML = rf+"outbox/"
}

</script>

<body onload="init()">

  if your are not logged, use <a href="./session.html"> Shighl-Session</a> first.

  <fieldset>
    <legend>App folder create</legend>
    <input id="root-folder" oninput="rootFolderInput()" size="100"></input>
    <ul>
      <li>Inbox Folder : <span id="inbox-folder"></span> | <span id="indox-auth">AUTHENTICATED Agent Append (to receive notifications)</span></li>
      <li>Outbox Folder :<span id="outbox-folder"></span> | <span id="outbox-auth">AUTHENTICATED Agent Read (so other can see your activities)</span></li>
    </ul>

    <button onclick="createFolders()">Use those folders</button>
    <a href="" id="link-folder" target="_blank"></a>

  </fieldset>



  <fieldset>
    <legend>Send a note</legend>
    <input id="note-title" placeholder="Title" size="100"></input><br>
    <textarea id="note-content"placeholder="Content" cols="76" rows="7"></textarea><br>
    <button onclick="sendNote()">Send a Note</button>
  </fieldset>
  Look the web console to see more (Ctrl+Maj+i)<br><br>
  <a href="https://github.com/scenaristeur/shighl" target="_blank">Source</a>
  <br>
  <a href="index.html">Back to index</a>
</body>

</html>
